{"id":157,"date":"2017-11-23T14:53:37","date_gmt":"2017-11-23T14:53:37","guid":{"rendered":"https:\/\/xpoc.pro\/?p=157"},"modified":"2018-02-26T01:54:22","modified_gmt":"2018-02-25T23:54:22","slug":"how-the-bug-on-the-cloudflare-always-online-page-could-lead-to-unvalidated-redirect-on-the-any-site-including-hackerone","status":"publish","type":"post","link":"https:\/\/xp.ht\/how-the-bug-on-the-cloudflare-always-online-page-could-lead-to-unvalidated-redirect-on-the-any-site-including-hackerone\/","title":{"rendered":"How the bug on the CloudFlare \u00abAlways Online\u00bb page could lead to Unvalidated Redirect on the any site including hacker.one"},"content":{"rendered":"<p>Hello. This finding was closely related to the\u00a0<a href=\"https:\/\/hackerone.com\/reports\/214620\" target=\"_blank\" rel=\"noopener\">https:\/\/hackerone.com\/reports\/214620<\/a>\u00a0, but used the flaw in the URL parsing on the CloudFlare error page.<!--more--><\/p>\n<p style=\"text-align: justify;\">Maybe this finding does not worth a blog post, but it was not disclosed, and I need some practice in the blogging:)<\/p>\n<p style=\"text-align: justify;\">So I found this curious bug when researching domain <strong>hacker.one<\/strong><br \/>\nWhen the host, connected to Cloudflare, is offline\u00a0or experiencing connection timeout, default Cloudflare page is shown.<\/p>\n<p style=\"text-align: justify;\">However, if the link has the next format:\u00a0<strong>http[s]:\/\/host\/\/malicious_host\u00a0<\/strong>&#8211; it will be shown on the page as (example):<\/p>\n<p><img loading=\"lazy\" decoding=\"async\" class=\"aligncenter wp-image-163 size-full\" src=\"https:\/\/xpoc.pro\/wp-content\/uploads\/2017\/11\/test.png\" alt=\"\" width=\"1909\" height=\"998\" srcset=\"https:\/\/xp.ht\/wp-content\/uploads\/2017\/11\/test.png 1909w, https:\/\/xp.ht\/wp-content\/uploads\/2017\/11\/test-300x157.png 300w, https:\/\/xp.ht\/wp-content\/uploads\/2017\/11\/test-768x402.png 768w, https:\/\/xp.ht\/wp-content\/uploads\/2017\/11\/test-1024x535.png 1024w\" sizes=\"(max-width: 1909px) 100vw, 1909px\" \/><\/p>\n<pre class=\"highlight plaintext\">This page (https:\/\/hacker.one\/\/google.com) is currently offline.<\/pre>\n<p style=\"text-align: justify;\">But when the user will click this link &#8211; he will be redirected to the host\u00a0<strong>google.com<\/strong>\u00a0instead original\u00a0<strong>hacker.one<\/strong><\/p>\n<p style=\"text-align: justify;\">Why did\u00a0that happen?<br \/>\nThe generated link takes to the href tag the second part of the URL (query):<\/p>\n<pre class=\"highlight plaintext\">http[s]:\/\/[host]\/[query]<\/pre>\n<p style=\"text-align: justify;\">transforms to:<\/p>\n<pre class=\"highlight plaintext\">&lt;a href=\"\/[query]\" ...\r\n<\/pre>\n<p style=\"text-align: justify;\">So, if the [query] has\u00a0<strong>\/<\/strong>\u00a0in the beginning, we will get redirected to another host.<\/p>\n<p style=\"text-align: justify;\">So far it is affecting all CloudFlare users, who have for some reasons \u00abConnection timed out\u00bb page on their website, it could be a problem.<\/p>\n<p style=\"text-align: justify;\">So, how this can be exploited? Obviously, we have Unvalidated Redirect with user interaction (user must click the link), which itself has a\u00a0very low impact. But, it could be very useful in the oauth bypasses, when the attacker is able to use such URL as redirect_uri &#8211; in this case, code or token will be appended to the URL:<\/p>\n<pre>https:\/\/example.com\/\/attacker.com?token=xxxx<\/pre>\n<p>=&gt;<\/p>\n<pre>\/\/attacker.com?token=xxxx<\/pre>\n<p>CloudFlare fixed this bug by implementing URL normalization.<\/p>\n<p><em><strong>Timeline:<\/strong><\/em><\/p>\n<ul>\n<li>Apr 7, 2016 &#8211; initial discovery, report through HackerOne<\/li>\n<li>Apr 26, 2016 &#8211; issue was fixed by CloudFlare<\/li>\n<\/ul>\n","protected":false},"excerpt":{"rendered":"<p>Hello. This finding was closely related to the\u00a0https:\/\/hackerone.com\/reports\/214620\u00a0, but used the flaw in the URL parsing on the CloudFlare error page.<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":false,"template":"","format":"standard","meta":{"footnotes":""},"categories":[2],"tags":[],"_links":{"self":[{"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/posts\/157"}],"collection":[{"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/comments?post=157"}],"version-history":[{"count":3,"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/posts\/157\/revisions"}],"predecessor-version":[{"id":250,"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/posts\/157\/revisions\/250"}],"wp:attachment":[{"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/media?parent=157"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/categories?post=157"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/xp.ht\/wp-json\/wp\/v2\/tags?post=157"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}